<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <title>Identification of human control during walking</title>

  <!-- Required stylesheet -->
  <link rel="stylesheet" media="screen" href="deck.js/core/deck.core.css">

  <!-- Extension CSS files go here. Remove or add as needed. -->
  <link rel="stylesheet" media="screen" href="deck.js/extensions/goto/deck.goto.css">
  <link rel="stylesheet" media="screen" href="deck.js/extensions/menu/deck.menu.css">
  <link rel="stylesheet" media="screen" href="deck.js/extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" media="screen" href="deck.js/extensions/status/deck.status.css">
  <link rel="stylesheet" media="screen" href="deck.js/extensions/scale/deck.scale.css">

  <!-- Style theme. More available in /themes/style/ or create your own. -->
  <link rel="stylesheet" media="screen" href="deck.js/themes/style/swiss.css">

  <!-- Transition theme. More available in /themes/transition/ or create your own. -->
  <link rel="stylesheet" media="screen" href="deck.js/themes/transition/horizontal-slide.css">

  <!-- Basic black and white print styles -->
  <link rel="stylesheet" media="print" href="deck.js/core/print.css">

  <!-- Required Modernizr file -->
  <script src="deck.js/modernizr.custom.js"></script>

  <!-- Custom stylesheet -->
  <link rel="stylesheet" href="style.css">

  <!-- MathJax -->
  <!-- https://github.com/mathjax/MathJax/wiki/LFAQ----less-frequently-asked-questions#how-can-i-configure-a-local-fallback-for-the-cdn -->
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
  <script>window.MathJax || document.write('<script type="text/x-mathjax-config">MathJax.Hub.Config({"HTML-CSS":{imageFont:null }});<\/script>
  <script src="/home/moorepants/bin/MathJax/MathJax.js?config=TeX-AMS_HTML-full"><\/ script>')</script>

</head>

<body>
  <div class="deck-container">

    <!-- Begin slides. Just make elements with a class of slide. -->

    <section class="slide">
      <h2>Identification of human control during walking</h2>
      <h3>Jason K. Moore <small>j.k.moore19@csuohio.edu</small></h3>
      <p>Human Motion and Control Laboratory <a
        href="http://hmc.csuohio.edu">[hmc.csuohio.edu]</a></p>
      <p>Cleveland State University, Cleveland, Ohio, USA</p>
      <p>June 6, 2014</p>
      <footer style="position:absolute;bottom:0;font-size:75%;">
        <a href="http://tudelft.nl">TU Delf
          Robotics Talk 2014</a>, Delft, Netherlands
      </footer>
    </section>
    <!--
      Hi, My name is Jason Moore and I'm currently a postdoctoral researcher in
      Ton van den Bogert's human motion and control lab at Cleveland State
      University. Today I'm going to tell you about our preliminary work on
      identifying the control systems in able bodied humans during walking and
      potential application to powered exoskeletons.
    -->

    <section class="slide">
      <h2>Background</h2>
        <p>Doctoral work on identification of the human controller in the
        bicycle balancing task.</p>
        <table class="side-by-side">
          <tr>
            <td>
              <img src="img/tu-delft-bicycle-mocap.jpg" />
              <p>TU Delft 2008-2009</p>
            </td>
            <td>
              <img src="img/davis-delft-bicycle-collab.jpg" />
              <p>UC Davis 2009-2012</p>
            </td>
          </tr>
        </table>
    </section>
    <!--
      The last work major project I worked on was the identification of the
      bicycle/rider system both the plant and the controller. I did the
      majority of my doctoral work at UC Davis, but was also fortunate to spend
      a year here with Arend Schwab and Jodi Kooijman at the bicycle dynamics
      lab. The photo on the left is from of some our experimental work we did
      here. You can see me sporting the TU Delft bicycle racing outfit and the
      photo on the right is of the instrumented bicycle we built on the right.
      The tall fellow on the right is Peter de Lange who was a TU Delft
      master's student who worked with us in Davis, CA. We had good success
      with the bicycle/rider identification. This problem has some advantages
      over the walking system with fewer degrees of freedom and the possibility
      of linearizing the system so that discrete time domain system
      identification techniques could be used.
    -->

    <section class="slide">
      <h2>Lower Extremity Exoskeletons</h2>
      <table class="side-by-side">
        <tr>
          <td>
            <video width="640" height="480" controls>
              <source src="vid/exoskeletons.mp4" type="video/mp4">
              <source src="vid/exoskeletons.ogg" type="video/ogg">
            Your browser does not support the video tag.
            </video>
          </td>
          <td>
            <h3>Desired improvements</h3>
            <ul>
              <li>Natural gait patterns</li>
              <li>Balance</li>
            </ul>
            <h3>Additional Benefits</h3>
            <ul>
              <li>Quantification of control can possibly be used to assess
                subjects</li>
            </ul>
          </td>
        <tr>
      </table>
      <p><small>Clips collected from <a href="http://youtu.be/-bYYmZNxaZk">[1]</a>, <a
          href="http://youtu.be/bhCAkUMQ5GA">[2]</a>, <a
          href="http://youtu.be/XpVVEYOkj34">[3]</a>, and <a
          href="http://youtu.be/SS1MFoz1Cp0">[4]</a>.</small></p>
      <!--
      http://youtu.be/-bYYmZNxaZk
      http://youtu.be/bhCAkUMQ5GA
      http://youtu.be/XpVVEYOkj34
      http://youtu.be/SS1MFoz1Cp0
      -->
    </section>
    <!--
      To give the impetus for what we are thinking about I'll start with a
      short video that shows a few of examples of exoskeletons that have been
      developed to help people with spinal cord injuries walk with mechanical
      assistance. These types of devices are remarkable in that they allow a
      paralyzed person to take steps again, but there is still a lot of work to
      be done to provide both natural gait and balance. We are interested in
      identifying control schemes used by able-bodied walkers and mapping those
      to the CPU, sensor, and actuator network inside these powered
      exoskeletons.

      So how do we make these devices behave more like a human:

      Optimal Control? Do we do things optimally? Maybe, but probably not
      always.  Use data generated by humans  to figure out how a human actually
      controls: defects and all.
    -->

    <section class="slide">
      <h2>Prior Art</h2>
      <p>
      <ul>
        <li>Identification during standing: quite a lot</li>
        <li>Identification during gait [Rouse, ...]</li>
        <li>Piecewise linear impedance control: [Goldfarb, ...]</li>
        <li>Identification of active and passive dynamics in limb movement:
          fair amount, Kearney et.al, etc</li>
        <li>Step variation quantifications under perturbations: [Collins, Hof,
          ..]</li>
        <li>Impedance control and ID</li>
      </ul>
    </section>
    <!--
      There is work on identification of both the human's control system and
      the human plant. The earliest attempts at this come from the aircraft
      domain where researchers started in the 50s identifying the human
      controller for visual to control stick tasks. Now there are a variety of
      papers that attempted to identify the human system in various tasks but
      most are focused on single limbs or joints. The literature is also fairly
      rich in the standing and balance identification. And some of this has
      been applied to powered prosthetics. But for a full body human gait
      controller, there isn't much out there. Elliot Rouse has some nice papers
      on ankle identification in the stance phase of walking and there are
      papers that quantify various measurements under perturbations.
    -->

    <section class="slide">
      <h2>Rouse 2011-2014</h2>
      <p>Elliot Rouse and co-authors identified the "controller" for the ankle
        from external perturbations.</p>
      <ul>
        <li>Ankle model identification in stance phase</li>
        <li>Ramp perturbations from a rotating force platform</li>
        <li>~400 steps per subject</li>
        <li>Identified canonical model: \(T = I (\ddot{\theta}) + C
        (\dot{\theta}) + K \dot(\theta) \)</li>
      </ul>
    </section>
    <!--
      Rouse, in particular, has the closest work to what I'll present today. He
      uses a perturbator force plate robot to induce variations in human
      walking and identified a canonical model where he gets estimates of the
      passive and active, ankle inertia, stiffness, and damping using a direct
      identification approach.
    -->

    <section class="slide">
      <h2>Neuromuscular System</h2>
      <img src="img/kearney-1990-control-diagram.png" />
      <br>
      <footer style="position:absolute;bottom:0;font-size:75%;">
        Kearney and Hunter, “System Identification of Human Joint Dynamics.”,
      1990.
      </footer>
    </section>
    <!--
      To start off here is a diagram from Kearney 1990 that gives an idea of
      how the human limb dynamic system is commonly modeled.
      -  Limb dynamics: newton's 2nd law
      - External torques: from environment interaction
      - Articular mechanics: visoelastic properties of joint surface, ligaments,
        and connective tissue, generally small but large at extended range of
        motion
      - Muscle mechanics: contractile dynamics (non-linear spring) and activation dynamics (reflex or
        voluntary activation)
      - Reflex effects: muscle spindles, golgi tendon
      This is the basic framework where much of this is fundamentally unknown and
      identification techniques can and do shed some like into the picture.
    -->

    <section class="slide">
      <h2>Idealized Gait Feedback Control</h2>
      <img src="img/control-system-detailed.png" />
      <table class="side-by-side">
        <tr>
          <td style="padding: 30px;">
            <h3>Estimated</h3>
            <ul>
              <li>\(\varphi\): Phase of gait cycle</li>
              <li>\(\mathbf{s}(\varphi)\): Joint angles and rates</li>
              <li>\(\mathbf{m}(\varphi)\): Joint torques</li>
              <li>\(w(t)\): Random belt speed</li>
            </ul>
          </td>
          <td style="padding: 30px;">
            <h3>Unknown</h3>
            <ul>
              <li>\(\mathbf{K}(\varphi)\): Matrix of feedback gains</li>
              <li>\(\mathbf{s}_0(\varphi)\): Open loop joint angles and rates</li>
              <li>\(\mathbf{m}_0(\varphi)\): Open loop joint torques</li>
            </ul>
          </td>
        </tr>
      </table>
    </section>
    <!--
      With that framework in mind and human gait as the desired dynamics, we
      start by modeling the human during cyclic walking as a multi-input/output
      feedback system. The human plant is driven by joint torques and can be
      perturbed by external inputs. Some function of the state is sensed, the
      kinematics in our case, and subtracted from a nominal or open loop
      solution to cyclic gait. The controller then computes the additive inputs
      to the nominal or open loop joint torques to drive the walker back to the
      nominal cyclic walking pattern.

      We approach the identification of the controller from a direct
      identification-like method. We assume that we can have good "measured"
      estimates of the joint angles, rates, and torques throughout the phase of
      the gait cycle, phi. To ensure that feedback control is used, we perturb
      the plant (the human) with random external perturbations, which are also
      measured. Our goal being to find a feedback gain matrix that relates the
      sensor error to the plant inputs. And for simplicity's sake we assume
      that the gait cycle is controlled by a clock. The controller is made up
      of both the active and passive control elements, i.e. everything that
      contributes to the joint torques.
    -->

    <section class="slide">
      <h2>Typical Dynamic Gait Lab Measurements</h2>
      <ul>
        <li>Ground reaction loads at each foot</li>
        <li>Inertial musculoskeletal marker positions</li>
        <li>Body segment angular velocity</li>
        <li>Point accelerations</li>
        <li>Muscle activation: EMG</li>
        <li>Travel (or belt) speed</li>
      </ul>
      <h2>Computed Estimates</h2>
      <ul>
        <li>Joint torques</li>
        <li>Joint angles, angular velocities, angular accelerations</li>
        <li>Muscle forces, lengths</li>
        <li>Center of pressure</li>
      </ul>
    </section>
    <!--
      One disadvantage we have is that we can really measure what we really
      want. We only get a very external picture of the human system.  Modern
      gait labs can typically measure things like the ground reaction loads,
      marker positions, EMG, etc. These measurements allow us to compute
      estimates of the joint angles, angular velocities, acceleration, muscle
      forces, and lengths, etc.
    -->

    <section class="slide">
      <h2>What sensors are likely most important for human gait control?</h2>
      <ul>
        <li>Proprioception (muscle spindles, Golgi tendon): relative position of body
            parts, muscle tension (gait timing)</li>
        <li>Vestibular (semicircular canals, otoliths): angular rotation and
          rate, linear acceleration (horizontal and vertical), gravity
          direction</li>
        <li>Sight: global and body relative orientation, position</li>
        <li>Touch: force on feet</li>
      </ul>
      <h2>Sensors available to external prosthetics</h2>
      <ul>
        <li>Relative joint position</li>
        <li>Body fixed angular velocity</li>
        <li>Body fixed point accelerations</li>
        <li>Force transducers and pressure sensors</li>
      </ul>
    </section>
    <!--
      But what variable are most important here. If we want to mimic the human
      control system with a powered prosthetic we are likely to need similar
      sensors and actuators. A powered prosthetic that doesn't have in vivo
      connections to the humans neurological system can most likely mimic the
      proprioceptive feedback system.
    -->

    <section class="slide">
      <h2>Closed Loop System Identification</h2>
      <p>Closed loop system id is possible, but one must be aware of several
      issues. Here are two common methods:</p>
      <ul>
        <li>Direct Approach: measure \(u\), \(y\) where \(P\) and \(C\) are unknown</li>
        <li>Indirect Approach: measure \(r\), \(y\) where either \(P\) or \(C\)
        is known</li>
      </ul>
      <img src="img/simple-control-block-diagram.png" />
    </section>
    <!--
      If we measure a human in gait, we will ultimately be trying to identify
      the controller in the closed loop system. I'll talk about two methods
      that can be used to identify an open loop element from data from a closed
      loop system. This block diagram is the familiar SISO CLS, but it has the
      element v(t) which represents the noise in the measurements from
      perturbations in the plant. The direct approach would use u and y to
      identify P or C by treating the data as if it came from an open loop
      system. The indirect approach relies on r, u, and y along with a model of
      the plant or controller.
    -->

    <section class="slide">
      <h2>Direct Approach</h2>
      <p>Measure \(u(t)\) and \(y(t)\), ignore feedback, and fit a model to the
        data.</p>
      <p>If the direct method is used in the frequency domain the external
        perturbations must be high enough to bias the identification towards the
        controller, rather than the plant. (Kearny 1990, Ljung 1999, van der
        Kooij 2005)</p>
      <p>
      \[ G(s) = \frac{y(s)}{u(s)} =
        \frac{P(s) \Phi_r(\omega) - C(s) \Phi_v(\omega)}
             {\Phi_r(\omega) + |C(s)|^2 \Phi_v(\omega)}
      \]
      </p>
      <p>
        If \( \Phi_r(w) >> \Phi_v(\omega) \) : \( G(s) = P(s) \)
      </p>
      <p>
        If \( \Phi_v(w) >> \Phi_r(\omega) \) : \( G(s) = -\frac{1}{C(s)} \)
      </p>
    </section>
    <!--
      We will be using the direct approach in the following analysis and it is
      well known that the identified element can be biased. This is most easily
      seen from the SISO frequency domain view. If one wants to identify the
      transfer function G which represent y over u, and the set point or sensor
      noise and the plant noise have a given spectrum, then you will identify
      some combination of the plant and the controller. Now if the external
      perturbation spectrum is dominant with respect to the sensor noise, you
      will get something proportional to the controller and vice versa for the
      plant.
    -->

    <section class="slide">
      <h2>Direct Approach</h2>
      <p>But time domain identification may be possible if the bias is reduced
        by one or all of the following:</p>
      <ul>
        <li>The closed loop data is informative</li>
        <ul>
          <li>\(r\) is persistently excited</li>
          <li>Nonlinear or time varying or complex (high order) regulators</li>
        </ul>
        <li>Using suitable pre-filtering, i.e. inclusion of a good noise model</li>
        <li>Reducing the feedback contribution to the input spectrum \(\Phi
          u\)</li>
        <li>Large signal to noise ratio</li>
      </ul>
    </section>
    <!--
      Now, time domain identification still has an issues with bias, but
      various factors can influence whether the controller or the plant is
      ultimately identified. One key is to have informative data that isn't
      biased to the feedback from the plant. With the very non-linear and time
      dependent nature of the plant in the human system, this may be strong.
      Also, if the noise model used in the identification is close to the
      actual noise model, the bias is reduced. We've done some work on the
      quiet standing system that gives us confidence that the time domain
      identification is not biased if the external perturbations are there.
    -->

    <section class="slide">
      <h2>Controller Equations</h2>
      <img src="img/controller.png" />
      <p>
      \[
        \mathbf{m}(t) = \mathbf{m}_0(\varphi) + \mathbf{K}(\varphi) [\mathbf{s}_0(\varphi) - \mathbf{s}(t)] \\
      \]

      </p>

      <h3>Linear Form</h3>

      <p>
      \[
        \mathbf{m}(t) = \mathbf{m}^*(\varphi) - \mathbf{K}(\varphi) \mathbf{s}(t)
      \]

      where

      \[
        \mathbf{m}^*(t) = \mathbf{m}_0(\varphi) + \mathbf{K}(\varphi) \mathbf{s}_0(\varphi)
      \]
      </p>

      <footer style="position:absolute;bottom:0;font-size:75%;">
        <a href="http://nbviewer.ipython.org/github/moorepants/walking-sys-id/blob/master/src/notebooks/walking_least_squares.ipynb">
          The Maths
        </a>
      </footer>
    </section>
    <!--
      So, with that in mind we formulate a direct identification problem.  Since
      we can't measure the nominal joint kinematics or joint torques we can use
      a little equation rearranging to put the equation in a form that relates
      inputs to the controller to its outputs into a form that makes it linear
      in the gains and a term I will call m*, which equals the nominal torque
      if feedback is zero. This form can generalize to any number and type of
      sensors and control inputs.
    -->

    <section class="slide">
      <h2>Gain Matrix</h2>
      <h3>Sensors</h3>
      <p>Assume that a lower limb exoskeleton can sense relative orientation
      and rate of the right and left planar ankle, knee, and hip angles.</p>
      <p>
        \(\mathbf{s}(t) = \begin{bmatrix} s_1 & \dot{s}_1 & \ldots & s_q & \dot{s}_q \end{bmatrix} \) where \(q=6\)
      </p>
      <h3>Controls (plant inputs)</h3>
      <p>Assume that the exoskeleton can generate planar ankle, knee, and hip joint
      torques.</p>
      <p>
        \(\mathbf{m}(t) = \begin{bmatrix}m_1 & \ldots & m_q \end{bmatrix} \) where
        \(q=6\)
      </ul>
      <h3>Gain Matrix [Proportional-Derivative Control]</h3>
      <p>
        \(
        \mathbf{K}(\varphi) =
          \begin{bmatrix}
            k(\varphi)_{s_1} & k(\varphi)_{\dot{s_1}} & 0                & 0                      & 0      & \ldots           & 0\\
            0                & 0                      & k(\varphi)_{s_2} & k(\varphi)_{\dot{s_2}} & 0      & \ldots           & \vdots\\
            0                & 0                      & 0                & 0                      & \ddots & 0                & 0\\
            0                & 0                      & 0                & \ldots                 & 0      & k(\varphi)_{s_q} & k(\varphi)_{\dot{s}_q} \\


          \end{bmatrix}
        \)

    </section>
    <!--
      From now on I'll use a simplified controller model. The idea is to try to
      extract a controller for sensors and control inputs available on an
      exoskeleton from data collected from an able bodied human. So we
      formulate a simple 2D PD controller that feeds back angle and rate at the
      ankle, knee, and hip locally to produce torque at that joint.
    -->

    <section class="slide">
      <h2>Linear Least Squares</h2>
      <p>With \(n\) time samples in each gait cycle and \(m\) cycles there are
      \(mnq\) equations and  which can be used to solve for the \(nq(p+1)\)
      unknowns: \(\mathbf{m}^*(\varphi)\) and \(\mathbf{K}(\varphi)\). This is
      a classic overdetermined system of linear equations that can be solved
      with linear least squares.</p>
      <p>
        \[\mathbf{A}\mathbf{x}=\mathbf{b}\]
        \[\hat{\mathbf{x}}=(\mathbf{A}^T\mathbf{A})^{-1}\mathbf{A}^T\mathbf{b}\]
      </p>
      <ul>
        <li>\(n=20,m\sim=400,q=6,p=12\)</li>
        <li>\(\mathbf{A}\) (48000 x 1560): joint angles and rates</li>
        <li>\(\mathbf{b}\) (48000 x 1): joint torques</li>
        <li>\(\mathbf{x}\) (1560 x 1): \(\mathbf{K}(\varphi)\) and \(\mathbf{m}^*(\varphi)\)</li>
      </ul>
    </section>
    <!--
      Given that we can estimate the joint angles, rates, and torques from
      mocap and force data during walking we can formulate the problem into a
      linear least squares problem in which we can solve for the gains given
      enough data.
    -->

    <section class="slide">
      <h2>Experimental Protocol</h2>
      <ul>
        <li>Full body 3D motion capture: 47 markers <a href="#footnote-1">[1]</a></li>
        <li>Dual 6 DoF force plates</li>
        <li>2 minutes of unperturbed walking</li>
        <li>8 minutes (~500 gait cycles) walking under longitudinal perturbations</li>
        <li>Three walking speeds: 0.8, 1.2, 1.6 m/s</li>
        <li>11 subjects (male: 7, female: 4)</li>
        <li>Pseudo-random longitudinal perturbations: \(\pm 5\%\) nominal belt speed</li>
      </ul>

      <footer style="position:absolute;bottom:0;font-size:75%;">
        <p id="footnote-1">[1] Bogert et al., “A Real-Time System for Biomechanical
          Analysis of Human Movement and Muscle Function”, 2013.</p>
      </footer>
    </section>
    <!--
      So we set out to collect a larger than normal set of data from able
      bodied walkers using a modern gait lab. We collect approximately 500
      steps of data at 100hz over 8 minutes. The key addition here is that we
      longitudinally perturb the subject while walking to ensure that more
      control that normal is required to balance.
    -->

    <section class="slide">
      <h2>Random Belt Speed Variations</h2>
      <img src="img/belt-speed.png" />
    </section>
    <!--
      The belt speed varies randomly around the nominal speed.
    -->

    <section class="slide">
      <h2>Random Belt Speed Variations</h2>
      <video width="640" height="480" controls>
        <source src="vid/longitudinal-perturb-1.2-mps.mp4" type="video/mp4">
        <source src="vid/longitudinal-perturb-1.2-mps.ogg" type="video/ogg">
      Your browser does not support the video tag.
      </video>
    </section>
    <!--
      This video shows a subject walking while being perturbed. Notice that each
      step is slightly different than the previous.
    -->


    <section class="slide">
      <h2>Data Processing</h2>
      <ol>
        <li>Fill missing markers</li>
        <li>Filter marker positions and ground reaction loads 6 hz low pass
          filter</li>
        <li>Compute joint angles, rates, and torques using 2D inverse
          dynamics</li>
        <li>Section data into variable duration gait cycles based on right foot
          heel strikes</li>
        <li>Re-sample each gait cycle at 20 equally spaced samples</li>
        <li>Construct the design matrix (regressor), \(\mathbf{A}\) and the
          output vector, \(\mathbf{b}\)</li>
        <li>Solve for \(\mathbf{m}^*(\varphi)\) and
          \(\mathbf{K}(\varphi)\)</li>
        <li>Compute regression statistics and visualize</li>
      </ol>
    </section>
    <!--
      We collect marker and ground reaction data and use it to compute the 2D
      joint angles, rates, and torques. Then the data is sectioned into gait
      cycles based on the right side's heel strikes. Each cycle is then
      re-sampled at 20 samples per cycle. Then the design matrix, A, is formed
      and the vector of moment measurements. Finally, we solve for m* and the
      gains.
    -->

    <section class="slide">
      <h2>Measurement Variations</h2>
      <table class="side-by-side">
        <tr>
          <td>
            <img src="img/ankle-cycles-normal-walking.png" />
            <p>Unperturbed</p>
          </td>
          <td>
            <img src="img/ankle-cycles-perturbed-walking.png" />
            <p>Perturbed</p>
          </td>
        </tr>
      </table>
    </section>
    <!--
      Our 2D kinematic and kinetic estimates for each step look something like
      this. Notice that the variation in the step is much larger than
      unperturbed walking.
    -->

    <section class="slide">
      <h2>Gains: v=0.8 m/s</h2>
      <img src="img/mean-gains-0.8.png" />
    </section>
    <!--
      I then take 3/4's of each trial and cram the data into the least squares
      solver and it produces some gait phase scheduled gains. This graph shows
      the mean gain curves as a function of phase in the gait cycle for the
      right and left legs of 4 subjects walking at 0.8 m/s. The graphs show the
      gains that map the measurement kinematic variable to the torque in the
      same joint. We see that different subjects have similar gain profiles,
      although there is some variation. All but the hip rate feedback term has
      zero gain in the swing phase and larger gains in the stance phase. Notice
      too that both negative and positive feedback is used during the gait
      cycle.
    -->

    <section class="slide">
      <h2>Gains: v=1.2 m/s</h2>
      <img src="img/mean-gains-1.2.png" />
    </section>
    <!--
      We see similar patterns as the walking speed increases. In this case, to
      1.2 m/s.
    -->

    <section class="slide">
      <h2>Gains: v=1.6 m/s</h2>
      <img src="img/mean-gains-1.6.png" />
    </section>

    <section class="slide">
      <h2>Gain variation with speed</h2>
      <img src="img/mean-gains-vs-speed.png" />
    </section>
    <!--
      We can also take a look how the mean gains across subjects vary with
      respect to speed. The solid lines are the slow speed, the dashed the
      medium, and the dotted the high speed walking. Some curves seem to vary
      little with speed and others show some variation: increasing/decreasing
      with speed or drastic change from low to high speed. We see a decidedly
      different behavior in the knee rate gain during stance at the low speed.
    -->

    <section class="slide">
      <h2>How good is the model?</h2>
      <img src="img/validation-019.png" />
    </section>
    <!--
      So you may be wondering how good this simple 2D PD control model is. Well
      I am too. At this point the best thing I can say about it, is that given
      an independent set of joint angles and rates (the last 1/4 of each trial)
      the model can predict over 65% of the variance in the estimated torque
      data This plot shows the joint torques in each joint and each leg, both
      the measured values and the predicted values, along with the percent
      variance accounted for. The further the joint from the force plates the
      poorer the prediction.
    -->

    <section class="slide">
      <h2>Model Fit Improvements With Control</h2>
        <ul>
          <li>Identify \(\mathbf{m}^*\): \(mq\) parameters, VAF ~70%</li>
          <li>Identify \(\mathbf{m}^*\) and joint isolated \(\mathbf{K}\): \(3mq\) parameters, VAF
          ~75%</li>
          <li>Identify \(\mathbf{m}^*\) and \(\mathbf{K}\): \(mq(p+1)\) parameters, VAF
          ~80%</li>
        </ul>
    </section>
    <!--
      It is important to note that if only m* is identified, assuming K = 0,
      then the mean of the torques is computed and that the mean torques
      explain about 70% on average of the variance in the data. This increases
      by 5% if the joint isolated gain matrix is used and 5% more percent if
      the full gain matrix is identified. This controller accounts for about
      10% of the data.
    -->

    <section class="slide">
      <h2>Summary</h2>
      <ul>
        <li>External perturbations must be higher that sensor noise to have any
          hope of estimating control in this fashion.</li>
        <li>Similar gain patterns in each leg.</li>
        <li>Similar gain patterns and magnitudes in different subjects.</li>
        <li>The gains are low magnitude in the swing phase and higher in
          magnitude in the stance phase.</li>
        <li>Negative velocity gains do not make much sense yet. More
          investigation is needed.</li>
        <li>The model can predict the joint torques for independent data.</li>
        <li>Can we put this controller into an exoskeleton?</li>
      </ul>
    </section>
    <!--
      So to summarize, we've used a simple control model structure and a large
      set of data to tease out numerical values for the scheduled gains during
      walking by longitudinally perturbing the subjects. We see similar
      patterns in the gains across subjects and are able to predict joint
      torques very well.

      Can we put this controller into an exoskeleton? Well the positive
      velocity feedback may make thing go nuts but the angle gains are worth
      trying.
    -->

    <section class="slide">
      <h2>Future</h2>
      <ul>
        <li>Different Controller Structures</li>
        <ul>
          <li>Additional sensors: acceleration, foot pressure, etc</li>
          <li>Add in time delays</li>
          <li>Remove clock from controller (state dependent)</li>
          <li>Non-linear control models: e.g. neural network.</li>
        </ul>
        <li>Use indirect system identification approach with plant model.</li>
        <li>Simulate plant with open loop controls plus identified feedback.</li>
        <li>Try out the controller on the Indego exoskeleton.</li>
      </ul>
    </section>
    <!--
      We have a lot more to do here before we make solid conclusions. The data
      I showed was rather preliminary. We plan to explore more gain matrices,
      add time delays for neural processing, remove the scheduling and try to
      make the gains a function of state instead of phase, look into more
      complex control models, try out indirect ID, and try out the controllers
      in simulation and an actual exoskeleton.
    -->

    <section class="slide">
      <h2>Indirect Identification: Shooting</h2>
      <p>Closed Loop Simulation + Genetic Algorithms, requires musculoskeletal model</p>
      <ul>
        <li>Closed Loop EoM: \( \dot{x} = f(x, u, t, k) \)</li>
        <li>Simulation Outputs: \( y = g(x, u, t) \)</li>
        <li>Measured marker positions, ground reaction loads, etc: \(y^m\)</li>
        <li>Cost function: \( J = \frac{1}{w_1}\sum_{i=0}^n || y_i - y_i^m || + \frac{1}{w_2}
        \int_0^T T^2 dt + \frac{1}{\mathrm{stability}} + \ldots\) </li>
        <li>Free parameters: \(k_j \ldots k_m\)</li>
      </ul>
      <h3>Advantages</h3>
      <ul>
        <li>Results in a stable model with working controller</li>
        <li>Few optimization parameters</li>
        <li>Optimization can be parallelized</li>
      </ul>
      <h3>Disadvantages</h3>
      <ul>
        <li>Computational load is really high: real time simulation for 8 min
          100 hz may take 400 hrs with 3000 optimization iterations<a
            href="#Wang2012">[1]</a></li>
        <li>Genetic algorithms may only get close to the global minimum</li>
        <li>Controller depends on plant fidelity</li>
      </ul>
      <footer style="position:absolute;bottom:0;font-size:75%;">
        <p id="Wang2012">[1] Wang et al., “Optimizing Locomotion Controllers
          Using Biologically-Based Actuators and Objectives.”, 2012.</p>
      </footer>
    </section>
    <!--
      I'll close with a little about what I'm working on now. I'm going to see
      if an indirect identification will give similar results. I'm not sure of
      another way to computationally determine if the directly identified
      controller is actually a valid controller. One way is to build model of
      the closed loop system which can be used in a shooting optimization
      approach. Genetic algorithms have been successful for computing the
      optimal control of walking models. The cost function I will use will
      minimize the residuals of the measured outputs with respect to the
      simulation outputs: marker position and/or ground reaction loads. Cost
      terms for minimal energy, stability, may be needed too.

      The main disadvantages of this method are extreme computational times.
      Only if I can get the simulation to run many times faster than real time
      and have a way to negatively adjust the cost if the simulation is very
      unstable will this have any chance of computing in a day on a cluster.
      This method also depends highly on the fidelity of the plant model and we
      have rather crude muscoulskeletal models. The model can be improved by
      identifying an additional noise model.
    -->

    <section class="slide">
      <h2>Indirect Identification: Direct Collocation</h2>
      <p>Constrained optimization of discretized model + gradient based large
        scale optimizer</p>
      <ul>
        <li>Cost Function: \[ J = \frac{1}{w_1} \sum_{i=0}^n || y_i - y_i^m || \]</li>
        <li>Constraints: \[ 0 = f(\dot{x}, x, u, t) \]
        <li>Optimizers: Sequential Quadratic Programming, Interior Point Optimization</li>
        <li>Free parameters: \(x_0 \ldots x_n \), \(k_j \ldots k_m\)</li>
      </ul>
      <h3>Advantages</h3>
      <ul>
        <li>No simulation required: lower computational cost, 10 of hours
          instead of hundreds of hours <a href="#Ackermann2010">[1]</a></li>
        <li>May get to the global optimum</li>
      </ul>
      <ul>
        <li>Large number of unknowns \(n \times p + m\)</li>
        <li>Gradients of cost function and constraints required</li>
        <li>Stable simulation may not be guaranteed</li>
      </ul>
      <footer style="position:absolute;bottom:0;font-size:75%;">
        <p id="Ackermann2010">[1] Ackermann and van den Bogert, “Optimality
          Principles for Model-Based Prediction of Human Gait.”, 2010</p>
      </footer>
    </section>
    <!--
      The second approach would be to formulate a similar problem but use
      constrained optimization with direct collocation. The cost function will
      still ensure the error in the outputs are minimize but no simulation is
      needed because the closed loop equations of motion will be formulated as
      constraints. This creates a very large number of free parameters, i.e.
      all the states at each time point and all of the controller parameters.
      Large scale gradient based optimizers will be needed to solve the
      problem. But this can be much more computationally efficient.
    -->

    <section class="slide">
      <h2>Information</h2>
      <h3>Contact</h3>
      <ul>
        <li>HMC Lab: <a href="http://hmc.csuohio.edu">hmc.csuohio.edu</a></li>
        <li>My website: <a href="http://moorepants.info">moorepants.info</a></li>
        <li>Email: j.k.moore@csuohio.edu</li>
      </ul>
      <h3>Slides</h3>
      <ul>
        <li>
          <a href="https://moorepants.info/presentations">
            moorepants.info/presentations
          </a>
        </li>
      </ul>
      <h3>Source code for this analysis</h3>
      <ul>
        <li>
          <a href="https://github.com/moorepants/walking-sys-id">
            github.com/moorepants/walking-sys-id
          </a>
        </li>
        <li>
          <a href="https://github.com/csu-hmc/Gait-Analysis-Toolkit">
            github.com/csu-hmc/Gait-Analysis-Toolkit
          </a>
        </li>
      </ul>
      <h3>Data</h3>
      <ul>
        <li>On its way!</li>
      </ul>
      <h3>Collaborators</h3>
      <ul>
        <li>Antonie J. van den Bogert</li>
        <li>Sandra K. Hnat</li>
      </ul>
    </section>

    <!-- End slides. -->

    <!-- Begin extension snippets. Add or remove as needed. -->

    <!-- deck.navigation snippet -->
    <div aria-role="navigation">
      <a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
      <a href="#" class="deck-next-link" title="Next">&#8594;</a>
    </div>

    <!-- deck.status snippet -->
    <p class="deck-status" aria-role="status">
      <span class="deck-status-current"></span>
      /
      <span class="deck-status-total"></span>
    </p>

    <!-- deck.goto snippet -->
    <form action="." method="get" class="goto-form">
      <label for="goto-slide">Go to slide:</label>
      <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
      <datalist id="goto-datalist"></datalist>
      <input type="submit" value="Go">
    </form>

    <!-- End extension snippets. -->
  </div>

<!-- Required JS files. -->
<script src="deck.js/jquery.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="deck.js/extensions/menu/deck.menu.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
  $(function() {
    $.deck('.slide');
  });
</script>
</body>
</html>
